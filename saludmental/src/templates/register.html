{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Registrarse - Be Man Be Woman" %}{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
<style>
  html,body{ height:100%; overflow:hidden; } /* sin scroll global */

  :root{
    --brand-1:#7f3cff; --brand-2:#3f8cff;
    --card-bg:rgba(255,255,255,.85);
    --text:#0f1222; --muted:#61677b; --ring:#7f3cff55;
    --input-bg:#fff; --input-bd:#e6e8ef;
  }
  [data-bs-theme="dark"]{
    --card-bg:rgba(16,18,24,.72);
    --text:#eaeef6; --muted:#a2a8bd; --ring:#7f3cff55;
    --input-bg:#12151d; --input-bd:#262a36;
  }
  .auth-wrap{
    height:100svh; display:grid; place-items:center;
    padding:clamp(12px,2.5vw,24px);
    background:
      radial-gradient(60rem 30rem at -10% -10%, #7f3cff22, transparent 60%),
      radial-gradient(60rem 30rem at 110% 110%, #3f8cff22, transparent 60%);
  }
  .card-modern{
    width:min(540px,94vw);
    background:var(--card-bg); backdrop-filter:blur(14px);
    border:1px solid rgba(127,60,255,.12);
    border-radius:18px; padding:clamp(18px,3.2vw,28px);
    box-shadow:0 10px 40px rgba(0,0,0,.18);
    animation:slideUp .55s cubic-bezier(.4,0,.2,1);
  }
  @keyframes slideUp{ from{opacity:0; transform:translateY(24px)} to{opacity:1; transform:none} }

  .title{
    font-weight:800; letter-spacing:.2px; text-align:center; margin:0 0 8px;
    background:linear-gradient(90deg,var(--brand-1),var(--brand-2));
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .subtitle{ color:var(--muted); text-align:center; margin:0 0 12px; }

  .form-grid{ display:grid; gap:10px; }
  @media (min-width:640px){ .grid-2{ grid-template-columns:1fr 1fr; gap:10px } }
  .field{ display:flex; flex-direction:column; gap:6px; }
  .label{ font-weight:600; color:var(--text); font-size:.95rem; }

  .input-icon{ position:relative; }
  .input-icon .icon-left{ position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--muted); font-size:1.1rem; }
  .bm-input{
    width:100%; border-radius:12px; background:var(--input-bg); color:var(--text);
    border:1.5px solid var(--input-bd); padding:12px 14px; outline:none;
    transition:border-color .2s, box-shadow .2s, background .2s;
  }
  .input-icon .bm-input{ padding-left:42px; }
  .bm-input:focus{ border-color:var(--brand-1); box-shadow:0 0 0 4px var(--ring); }

  .input-groupish{ position:relative; }
  .btn-eye{ position:absolute; right:8px; top:50%; transform:translateY(-50%); width:38px; height:38px;
    display:grid; place-items:center; border:0; background:transparent; color:var(--muted); border-radius:10px; cursor:pointer;
  }
  .btn-eye:hover{ color:var(--text); }

  .strength{ height:6px; border-radius:6px; background:#e1e5ee22; overflow:hidden; margin-top:6px; }
  .strength > i{ display:block; height:100%; width:0%; background:linear-gradient(90deg,#ff4d4d,#ffd166,#06d6a0); transition:width .35s; }

  .submit-btn{ width:100%; border:0; border-radius:12px; padding:12px 16px; font-weight:700;
    background:linear-gradient(90deg,var(--brand-1),var(--brand-2)); color:#fff; box-shadow:0 8px 22px rgba(63,140,255,.28);
    transition:transform .08s ease, box-shadow .2s ease; margin-top:10px;
  }
  .submit-btn:active{ transform:translateY(1px); box-shadow:0 6px 16px rgba(63,140,255,.24); }

  .foot{ text-align:center; color:var(--muted); margin-top:8px; }
  .foot a{ color:var(--brand-2); text-decoration:none; font-weight:700; }
  .foot a:hover{ text-decoration:underline; }

  /* Compacta si la altura es baja para evitar scroll */
  @media (max-height: 720px){
    .subtitle{ display:none; }
    .form-grid{ gap:8px; }
    .field{ gap:6px; }
  }
</style>

<div class="auth-wrap">
  <div class="card-modern">
    <h2 class="title">{% trans "Crea tu cuenta" %}</h2>
    <p class="subtitle">{% trans "Únete a la comunidad y empieza ahora." %}</p>

    <form method="post" action="{% url 'register' %}" novalidate>
      {% csrf_token %}

      <div class="form-grid grid-2">
        <div class="field">
          <label class="label" for="first_name">{% trans "Nombre" %}</label>
          <div class="input-icon">
            <i class="ri-user-3-line icon-left"></i>
            <input id="first_name" name="first_name" type="text" class="bm-input" required autocomplete="given-name" />
          </div>
        </div>
        <div class="field">
          <label class="label" for="last_name">{% trans "Apellido" %}</label>
          <div class="input-icon">
            <i class="ri-user-3-line icon-left"></i>
            <input id="last_name" name="last_name" type="text" class="bm-input" required autocomplete="family-name" />
          </div>
        </div>
      </div>

      <div class="field" style="margin-top:6px">
        <label class="label" for="email">{% trans "Correo" %}</label>
        <div class="input-icon">
          <i class="ri-mail-line icon-left"></i>
          <input id="email" name="email" type="email" class="bm-input" required autocomplete="email" />
        </div>
      </div>

      <div class="field">
        <label class="label" for="username">{% trans "Usuario" %}</label>
        <div class="input-icon">
          <i class="ri-at-line icon-left"></i>
          <input id="username" name="username" type="text" class="bm-input" required autocomplete="username" />
        </div>
      </div>

      <div class="form-grid grid-2" style="margin-top:6px">
        <div class="field">
          <label class="label" for="password1">{% trans "Contraseña" %}</label>
          <div class="input-groupish input-icon">
            <i class="ri-shield-keyhole-line icon-left"></i>
            <input id="password1" name="password1" type="password" class="bm-input" required autocomplete="new-password" />
            <button type="button" class="btn-eye" aria-label="{% trans 'Mostrar/ocultar contraseña' %}" data-toggle-eye="#password1">
              <i class="ri-eye-line"></i>
            </button>
          </div>
          <div class="strength"><i id="pw-bar"></i></div>
        </div>
        <div class="field">
          <label class="label" for="password2">{% trans "Confirmar Contraseña" %}</label>
          <div class="input-groupish input-icon">
            <i class="ri-shield-keyhole-line icon-left"></i>
            <input id="password2" name="password2" type="password" class="bm-input" required autocomplete="new-password" />
            <button type="button" class="btn-eye" aria-label="{% trans 'Mostrar/ocultar contraseña' %}" data-toggle-eye="#password2">
              <i class="ri-eye-line"></i>
            </button>
          </div>
        </div>
      </div>

      <button type="submit" class="submit-btn">{% trans "Crear cuenta" %}</button>
    </form>

    <div class="foot">
      <small>{% trans "¿Ya tienes cuenta?" %} <a href="{% url 'login' %}">{% trans "Inicia sesión" %}</a></small>
    </div>
  </div>
</div>

<script>
  // Toggle de contraseña e indicador de fortaleza
  document.querySelectorAll('[data-toggle-eye]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const input = document.querySelector(btn.getAttribute('data-toggle-eye'));
      const icon = btn.querySelector('i');
      const show = input.type === 'password';
      input.type = show ? 'text' : 'password';
  icon.classList.toggle('ri-eye-line', !show);
  icon.classList.toggle('ri-eye-off-line', show);
    });
  });
  const pw = document.getElementById('password1');
  const bar = document.getElementById('pw-bar');
  function scorePassword(v){ let s=0; if(!v) return 0; if(v.length>=8)s+=25; if(/[A-Z]/.test(v))s+=20; if(/[0-9]/.test(v))s+=20; if(/[^A-Za-z0-9]/.test(v))s+=20; if(v.length>=12)s+=15; return Math.min(s,100); }
  function updateBar(){ if(bar && pw) bar.style.width = scorePassword(pw.value)+'%'; }
  if(pw){ pw.addEventListener('input', updateBar); updateBar(); }
</script>
{% endblock %}
